<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>todo test</title>
    <link rel="stylesheet" href="style.css" />
    <script src="todo.js"></script>
    <script src="dom-manipulation.js"></script>
  </head>
  <body>
    <script>
      // This assignment uses fetching from an external API, and DOM manipulation.
      // The API is https://jsonplaceholder.typicode.com/todos
      // The API returns a list of todo-entries.
      // The todo-entries have the following properties:
      // - id: number
      // - title: string
      // - completed: boolean
      // - userId: number
      //
      // Available functions:
      // - createAndAppendElement(parent, tag, attributes, children)
      // - clearBodyElement()
      // - todoList.fetchTodos()
      // - todoList.todos
      //
      // If you are unsure of something, please ask!

      // First, let's clear the body element
      clearBodyElement();

      // Then, let's fetch the todos
      todoList
        .fetchTodos()
        .then((todos) => {
          // creating and appending without the utility script
          const body = document.body;
          const main = document.createElement("main");
          body.appendChild(main);

          // For every todo-entry, we do something
          for (const todo of todos) {
            // ... Add the todo-entry to the DOM here!
            // Create Checkbox - Add checked if task is completed
            const checkbox = document.createElement("input");
            checkbox.setAttribute("type", "checkbox");
            if (todo.completed) {
              checkbox.setAttribute("checked", true);
            }

            // Create the paragraph for the task text
            const task_text = document.createElement("p");
            task_text.innerText = todo.title;

            // Use the utility script to create an article container for the todo item and append it to main
            const todo_article = createAndAppendElement(
              main,
              "article",
              {
                class: `userID-${todo.userId}`,
                id: `taskID-${todo.id}`,
              },
              [checkbox, task_text]
            );
          }
        })
        // If there is an error, we log it and set the todos to null
        .catch((error) => {
          console.error("Error fetching todos:", error);
          todoList.todos = null;
        })
        .finally(() => {
          // If the todos are null, we log a message
          if (todoList.todos === null) {
            console.log("No todos found");
            // Add some user-friendly feedback to the DOM.
            const feedbackElement = createAndAppendElement(
              document.body,
              "p",
              {
                class: "feedback",
                id: "feedback",
              },
              ["No todos found"]
            );
          }
        });
    </script>
  </body>
</html>
