<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>todo test</title>
    <link rel="stylesheet" href="style.css" />
    <script src="todo.js"></script>
    <script src="dom-manipulation.js"></script>
    <script src="./filtering.js"></script>
  </head>
  <body>
    <script>
      // This assignment uses fetching from an external API, and DOM manipulation.
      // The API is https://jsonplaceholder.typicode.com/todos
      // The API returns a list of todo-entries.
      // The todo-entries have the following properties:
      // - id: number
      // - title: string
      // - completed: boolean
      // - userId: number
      //
      // Available functions:
      // - createAndAppendElement(parent, tag, attributes, children)
      // - clearBodyElement()
      // - todoList.fetchTodos()
      // - todoList.todos
      //
      // If you are unsure of something, please ask!

      // First, let's clear the body element
      clearBodyElement();

      // Then, let's fetch the todos
      todoList
        .fetchTodos()
        .then((todos) => {
          // creating and appending without the utility script
          const main = document.createElement("main");
          main.setAttribute("id", "main_container");
          document.body.appendChild(main);

          // For every todo-entry, we do something
          for (const todo of todos) {
            // ... Add the todo-entry to the DOM here!
            // Create Checkbox - Add checked if task is completed
            const checkbox = document.createElement("input");
            checkbox.setAttribute("type", "checkbox");
            if (todo.completed) {
              checkbox.setAttribute("checked", true);
            }

            // Create the paragraph for the task text
            const task_text = document.createElement("p");
            task_text.innerText = todo.title;

            // Use the utility script to create an article container for the todo item
            // and append it to main
            const todo_article = createAndAppendElement(
              main,
              "article",
              {
                class: `userID-${todo.userId}`,
                id: `taskID-${todo.id}`,
              },
              [checkbox, task_text]
            );
          }
        })
        // If there is an error, we log it and set the todos to null
        .catch((error) => {
          console.error("Error fetching todos:", error);
          todoList.todos = null;
        })
        .finally(() => {
          // If the todos are null, we log a message
          if (todoList.todos === null) {
            console.log("No todos found");
            // Add some user-friendly feedback to the DOM.
            const feedbackElement = createAndAppendElement(
              document.body,
              "p",
              {
                class: "feedback",
                id: "feedback",
              },
              ["No todos found"]
            );
          }
        });

      const heading_title = document.createElement("h1");
      heading_title.innerText = "TODO List API Assignment";
      createAndAppendElement(document.body, "section", { id: "heading" }, [
        heading_title,
      ]);
      // Setup of all elements needed for filter
      const label_userid = document.createElement("label");
      const userid_search = document.createElement("input");
      const filter_btn = document.createElement("button");
      const clear_btn = document.createElement("button");

      // Setting attributes
      label_userid.setAttribute("for", "userid_searchbox");
      label_userid.innerText = "User ID: ";

      userid_search.setAttribute("name", "userid_searchbox");
      userid_search.setAttribute("placeholder", "1-10");
      userid_search.setAttribute("min", 1);
      userid_search.setAttribute("max", 10);
      userid_search.setAttribute("type", "number");
      userid_search.setAttribute("id", "userid_box");

      filter_btn.setAttribute("onclick", "filterResult()");
      filter_btn.setAttribute("type", "button");
      filter_btn.innerText = "Filter Result";

      clear_btn.setAttribute("onclick", "clearFilter()");
      clear_btn.setAttribute("type", "button");
      clear_btn.innerText = "Clear Filter";

      // Creation of section for filter
      createAndAppendElement(
        document.body,
        "section",
        { id: "filter_section" },
        []
      );

      const filter_section = document.getElementById("filter_section");
      // Creation of Form and appending all the child elements
      createAndAppendElement(filter_section, "form", { id: "filter_form " }, [
        label_userid,
        userid_search,
        filter_btn,
        clear_btn,
      ]);
    </script>
  </body>
</html>
